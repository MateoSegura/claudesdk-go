name: zephyr-esp32
description: >
  8 real Zephyr build failures affecting ESP32 targets, pinned to exact broken
  commits from upstream issues with merged fix PRs.

image: ghcr.io/mateosegura/devcontainer-zephyr:latest

volumes:
  zephyr-sdk: /usr/local/zephyr-sdk

entries:
  # --------------------------------------------------------------------------
  # Easy
  # --------------------------------------------------------------------------

  - id: adc-missing-header
    issue: https://github.com/zephyrproject-rtos/zephyr/issues/98692
    fix_pr: https://github.com/zephyrproject-rtos/zephyr/pull/98694
    broken_sha: b6c5d91
    difficulty: easy
    description: >
      ADC driver for ESP32 fails to compile due to a missing include for
      soc/soc_caps.h, causing undeclared identifier errors in the ADC HAL
      wrapper.
    board: esp32_devkitc_wroom
    app_path: samples/drivers/adc/adc_dt
    setup_commands:
      - ". /root/zephyrproject/zephyr/zephyr-env.sh"
      - "cd /root/zephyrproject/zephyr && git checkout b6c5d91"
    evaluation:
      command: "west build -b esp32_devkitc_wroom samples/drivers/adc/adc_dt"
      success_exit_code: 0

  - id: pwm-variable-rename
    issue: https://github.com/zephyrproject-rtos/zephyr/issues/45886
    fix_pr: https://github.com/zephyrproject-rtos/zephyr/pull/45888
    broken_sha: 67a0f95
    difficulty: easy
    description: >
      PWM driver fails to compile because a struct field was renamed in the
      HAL update but the driver source still references the old name.
    board: esp32_devkitc_wroom
    app_path: samples/basic/blinky_pwm
    setup_commands:
      - ". /root/zephyrproject/zephyr/zephyr-env.sh"
      - "cd /root/zephyrproject/zephyr && git checkout 67a0f95"
    evaluation:
      command: "west build -b esp32_devkitc_wroom samples/basic/blinky_pwm"
      success_exit_code: 0

  - id: log-const-soc-undefined
    issue: https://github.com/zephyrproject-rtos/zephyr/issues/100542
    fix_pr: https://github.com/zephyrproject-rtos/zephyr/pull/100603
    broken_sha: d59b2a2
    difficulty: easy
    description: >
      SoC-level logging constant LOG_CONST_SOC is undefined, causing a build
      failure in the ESP32 SoC init code when logging is enabled.
    board: esp32_devkitc_wroom
    app_path: samples/hello_world
    setup_commands:
      - ". /root/zephyrproject/zephyr/zephyr-env.sh"
      - "cd /root/zephyrproject/zephyr && git checkout d59b2a2"
    evaluation:
      command: "west build -b esp32_devkitc_wroom samples/hello_world"
      success_exit_code: 0

  - id: pinctrl-required-dts
    issue: https://github.com/zephyrproject-rtos/zephyr/issues/98992
    fix_pr: https://github.com/zephyrproject-rtos/zephyr/pull/98946
    broken_sha: 97fb97b
    difficulty: easy
    description: >
      DTS compilation fails because the pinctrl-0 property is marked as
      required in the binding but not provided in the ESP32 board DTS overlay,
      causing a dtc validation error.
    board: esp32_devkitc_wroom
    app_path: samples/hello_world
    setup_commands:
      - ". /root/zephyrproject/zephyr/zephyr-env.sh"
      - "cd /root/zephyrproject/zephyr && git checkout 97fb97b"
    evaluation:
      command: "west build -b esp32_devkitc_wroom samples/hello_world"
      success_exit_code: 0

  # --------------------------------------------------------------------------
  # Medium
  # --------------------------------------------------------------------------

  - id: heap-sentry-linker
    issue: https://github.com/zephyrproject-rtos/zephyr/issues/61443
    fix_pr: https://github.com/zephyrproject-rtos/zephyr/pull/61508
    broken_sha: d0d3f14
    difficulty: medium
    description: >
      Linker script bug causes the heap sentry symbol to be placed at the
      wrong address, resulting in an undefined reference during the final
      link stage for Xtensa targets.
    board: esp32_devkitc_wroom
    app_path: samples/hello_world
    setup_commands:
      - ". /root/zephyrproject/zephyr/zephyr-env.sh"
      - "cd /root/zephyrproject/zephyr && git checkout d0d3f14"
    evaluation:
      command: "west build -b esp32_devkitc_wroom samples/hello_world"
      success_exit_code: 0

  - id: hal-syslimits-break
    issue: https://github.com/zephyrproject-rtos/zephyr/issues/97074
    fix_pr: https://github.com/zephyrproject-rtos/zephyr/pull/97075
    broken_sha: ca85e76
    difficulty: medium
    description: >
      ESP32 HAL update introduces a dependency on syslimits.h which is not
      available in Zephyr's minimal libc, breaking the build for any ESP32
      application using the HAL.
    board: esp32_devkitc_wroom
    app_path: samples/hello_world
    setup_commands:
      - ". /root/zephyrproject/zephyr/zephyr-env.sh"
      - "cd /root/zephyrproject/zephyr && git checkout ca85e76"
      - "west update"
    evaluation:
      command: "west build -b esp32_devkitc_wroom samples/hello_world"
      success_exit_code: 0

  - id: wifi-kconfig-clock-gate
    issue: https://github.com/zephyrproject-rtos/zephyr/issues/74417
    fix_pr: https://github.com/zephyrproject-rtos/zephyr/pull/75680
    broken_sha: b4f49bf
    difficulty: medium
    description: >
      WiFi driver Kconfig depends on a clock gating symbol that was removed
      in a SoC refactor, causing unresolved Kconfig dependencies and a build
      failure when WiFi is enabled on ESP32.
    board: esp32_devkitc_wroom
    app_path: samples/net/wifi
    setup_commands:
      - ". /root/zephyrproject/zephyr/zephyr-env.sh"
      - "cd /root/zephyrproject/zephyr && git checkout b4f49bf"
    evaluation:
      command: "west build -b esp32_devkitc_wroom samples/net/wifi"
      success_exit_code: 0

  # --------------------------------------------------------------------------
  # Hard
  # --------------------------------------------------------------------------

  - id: boot-code-wrong-section
    issue: https://github.com/zephyrproject-rtos/zephyr/issues/95828
    fix_pr: https://github.com/zephyrproject-rtos/zephyr/pull/95741
    broken_sha: 9df6790
    difficulty: hard
    description: >
      ESP32 boot code is placed in the wrong linker section (.text instead of
      .iram0.text), causing the bootloader to fail at link time because
      IRAM-resident functions exceed the section boundary or reference
      symbols that are not yet mapped.
    board: esp32_devkitc_wroom
    app_path: samples/hello_world
    setup_commands:
      - ". /root/zephyrproject/zephyr/zephyr-env.sh"
      - "cd /root/zephyrproject/zephyr && git checkout 9df6790"
    evaluation:
      command: "west build -b esp32_devkitc_wroom samples/hello_world"
      success_exit_code: 0
